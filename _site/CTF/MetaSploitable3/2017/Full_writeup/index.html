<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      MetaSploitable3 Community CTF &middot; Rot26
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="page">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Rot26
      </a>
    </div>
    <p class="lead"></p>
  </header>
  <nav id="sidebar-nav-links">
  
  

  

  


  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  

  

  

  

  
    
  

  

  

  
    
  

  

  
    
  

  

  
    
  

  


  

<h1>CTFs</h1>

  
    
  

  
    
      <a class="category-link "
          href="/category/BreizhCTF.html">BreizhCTF</a>
    
  

  
    
      <a class="category-link "
          href="/category/Hacklu.html">Hacklu</a>
    
  

  
    
      <a class="category-link "
          href="/category/LabyREnth.html">LabyREnth</a>
    
  

  
    
      <a class="category-link "
          href="/category/MetaSploit.html">MetaSploit</a>
    
  

  
    
      <a class="category-link "
          href="/category/MetaSploitable3.html">MetaSploitable3</a>
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  

  

  

  

  
    
  

  

  

  
    
  

  

  
    
  

  

  
    
  

  



  <h1>Members</h1>
<a href="https://twitter.com/Memoi2001">Fooker</a>
<a href="https://twitter.com/kalimer0x00">Kalimer0x00</a>
<a href="https://twitter.com/govlog">Govlog</a>
<a href="https://twitter.com/maxencedun">Sp4rKy</a>


</nav>


  

  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  

  

  <!-- Optional additional links to insert for icons links -->
</nav>
  
</div>

    <main class="container">
      <div class="content">
  <h1 id="metasploitable3-community-ctf">MetaSploitable3 Community CTF</h1>

<h2 id="5-of-hearts">5 of hearts</h2>

<p>Once the platform had started we did the usual things.<br />
The nmap scan showed an open port 80 so let’s have a look there.</p>

<p>A quick ssh tunnel later and we have a directory listing, and a drupal folder.</p>

<p>On the drupal site we find and article called <code class="highlighter-rouge">I &lt;3 High-Fives!</code> that contains a picture:</p>

<p>![alt text](5_of_hearts.png “”)</p>

<p>Good start…</p>

<p>But the challenge mentions donuts and I can’t see any here, seems like a classic steganography challenge to me.<br />
Zsteg to the rescue!</p>

<p>In the text fields we get a HYUGE base64 blob, which unsurprisingly turns in to a PNG when decoded.</p>

<p><img src="5_hearts2.png" alt="alt text" title="DONUTS!" /></p>

<p>Ahh donuts, and a flag.</p>

<h2 id="8-of-hearts">8 of hearts</h2>

<p>While I was working of the 5 of hearts, my collegue who is a whiz at SQLI had gotten the database root password from the payroll_app.php<br />
So we had a look at the database and found the “super_secret_db”, looks interesting.</p>

<p>One table called flags containing a blob…<br />
We downloaded it and ran binwalk. This yielded a zip file, an encrypted zip file.<br />
But we don’t have a password.</p>

<p>Seeing as time was an issue I thought I’d run fcrackzip on it just in case while I looked around to see if it was hidden in the database.<br />
Turns out I didn’t even get a chance to look, fcrackzip and the rockyou password list got it in just over a second:</p>

<p>![alt text](8_of_hearts.png “”)</p>

<h2 id="getting-on-to-the-machine">Getting on to the machine</h2>

<p>So now it’s time to look at the machine properly.<br />
Nmap shows a few interesting services:<br />
ProFTPD 1.3.5
Samba smbd 3.X - 4.X workgroup: WORKGROUP
WEBrick httpd 1.3.1 Ruby 2.3.5
UnrealIRCd</p>

<p>So we started at the beginning, ProFTPD 1.3.5<br />
exploit/unix/ftp/proftpd_modcopy_exec        2015-04-22       excellent  ProFTPD 1.3.5 Mod_Copy Command Execution</p>

<p>But it didn’t work straight away :(<br />
We know we’re looking at a machine running ubuntu, the default apache folder is /var/www/html and not /var/www.<br />
We now have a shell! We realized later there were easier ways and this didn’t yield much.</p>

<p>We wanted a real user though, so we looked at the other services.<br />
We found the “UnrealIRCD 3.2.8.1 Backdoor Command Execution” module and proptly got a shell as boba_fett.<br />
We then quickly uploaded a key to his .ssh/authorized_keys and sshed in \o/</p>

<p>So, we have a user, we want root. uname -a and searchsploit revealed two privilege escalations using the overlayfs bug.
exploits/linux/local/37292.c &amp;&amp; gcc = UID 0!</p>

<p>Now that we’re root lets get to work.</p>

<h2 id="8-of-clubs">8 of clubs</h2>

<p>First things first, we ran <code class="highlighter-rouge">#find /home</code>, and damn that ubuntu user!<br />
So then we ran <code class="highlighter-rouge">#find /home | grep -v ubuntu</code> to find anything interesting, and interesting it was.</p>

<p>We get the flag for the 8 of clubs here:<br />
./anakin_skywalker/52/37/88/76/24/97/77/22/23/63/19/56/16/27/43/26/82/80/98/73/8_of_clubs.png</p>

<p>![alt text](8_of_clubs.png “”)</p>

<h2 id="2-of-spades">2 of spades</h2>

<p>We also saw <code class="highlighter-rouge">./leia_organa/2_of_spades.pcapng</code><br />
Copying this file to my local machine and opening it with wireshark we can see it’s a voip call.
Wireshark has an option to listen to calls recoreded in the pcap:</p>
<ul>
  <li>Telephony - voip calls<br />
Listening to it we get the following url spelled out:<br />
https://imgur.com/gmThKFP</li>
</ul>

<p>(This is almost the same as a challenge in the ringzer0team.com site so we breezed through it)</p>

<p>![alt text](2_of_spades.png “”)</p>

<h2 id="9-of-diamonds">9 of diamonds</h2>

<p>In kylo_ren’s home folder is a “hidden” folder:<br />
<code class="highlighter-rouge">.secret_files</code><br />
In this folder is an ISO, inside the ISO is the png</p>

<h2 id="3-of-hearts">3 of hearts</h2>

<p>The 3 of hearts was simply found in the /lost+found folder, no trickery other than needing root</p>

<p>![alt text](3_of_hearts.png “”)</p>

<h2 id="10-of-clubs">10 of clubs</h2>

<p>In artoo_detoo’s home is a wav file. Our first reflexes were listening to it (unpleasant), spectrographic analysis (unfruitful), then binwalk.<br />
This flag is actually the one that took us the most time, in fact we lost so much time on this one that mubix almost beat us.</p>

<p>Binwalk gave us <code class="highlighter-rouge">Zlib compressed data, default compression</code>, not png, so we didn’t probe any further at first.<br />
We looked in to lsb steganography of compressed wav formats and other esoteric things for over 3 hours before someone thought “fsck it, binwalk -e”.
And there we have it:<br />
<code class="highlighter-rouge">3A:      PNG image data, 500 x 700, 8-bit/color RGBA, non-interlaced</code></p>

<p>![alt text](10_of_clubs.png “”)</p>

<h2 id="king-of-spades">King of spades</h2>

<p>We saw the IRC server during the nmap scan, so I installed irssi on the metasploit machine.<br />
When connecting to it the MOTD was a base64 encoded message, so I painfully copy / pasted it to my local machine, cleaned it up and decoded it.<br />
Or at least I tried to, it seems we don’t get the complete message from IRC.</p>

<p>One of our team who hadn’t been working on the CTF until then and didn’t know we had root used the boba_fett backdoor and cated the irdc.motd file.<br />
A quick binwalk later and he got the flag.</p>

<h2 id="ace-of-clubs">Ace of clubs</h2>

<p>We were running out of easy flags to find do I started looking in to stuff we’d glossed over, like the chat bot.<br />
My first reflex was to go and look at the source code to see what it does.<br />
Inside chat_client.js I found a base64 blob and got the flag:</p>

<p>![alt text](ace_of_clubs.png “”)</p>

<p>While playing around with the CTF later to see what I’d missed I saw the command injection possible and even the “easy” solution of just asking the bot for the flag.</p>

<h2 id="7-of-diamonds">7 of diamonds</h2>

<p>We noticed a docker container running as well, when looking into it with <code class="highlighter-rouge">docker attach</code> we saw the zip file it contained.<br />
Extracting this we get an encrypted zip file and a hint.gif.<br />
As before I started up fcrackzip while I looked into the hint file.</p>

<p>The hint.gif turned out to be 313 seperate QR codes, we all know where this is heading.<br />
Splitting up the gif into seperate files with <code class="highlighter-rouge">convert -coalesce hint.gif out%05d.pgm</code> and decoding the first on yields a png header (yep, knew that was coming).<br />
so bash and zbarimg to the rescue:<br />
<code class="highlighter-rouge">$for i in </code><code class="highlighter-rouge">ls</code><code class="highlighter-rouge">; do zbarimg -q --raw $i; done &gt; temp_file</code>
<code class="highlighter-rouge">$cat temp | tr -d '\n' | xxd -r -p &gt; 7_of_diamonds.png</code></p>

<p>![alt text](hint.png “”)</p>

<p>With that password we can open the zip file and get:</p>

<p>![alt text](7_of_diamonds.png “”)</p>

<h2 id="10-of-spades">10 of spades</h2>

<p>While looking at the running processes we saw the readme_app.</p>

<p>We didn’t really need to look into it as a find command in the folder gave us the flag:</p>

<p>![alt text](10_of_spades.png “”)</p>

<h2 id="5-of-diamonds">5 of diamonds</h2>

<p>Another service running that looked intersting was the knockd service.<br />
Knockd is used to temporarily open ports, so looking at the config file we see what it opens if you get the sequence right.<br />
It opens up port 8989, trying netcat gave me an HTTP response, so let’s try curl…</p>

<p>Another base64 blob later and we have a flag:</p>

<p>![alt text](5_of_diamonds.png “”)</p>

<h2 id="joker">Joker</h2>

<p>A quick find command showed us all the png files available, including:
<code class="highlighter-rouge">/etc/joker.png</code></p>

<p>Aha, easy flag right? well no, the MD5 hash didn’t work..<br />
Looking at the picture we see it’s a negative, so we’ll just use convert:<br />
<code class="highlighter-rouge">$convert joker.png -negate joker2.png</code></p>

<p>Nop, still not the right flag.</p>

<p>Inverting the image also changes the metadata so we’ll be getting the wrong hash.<br />
(I even tried submiting the hashes backwards in case it was a trick)</p>

<p>In the end I used gimp, opened the file.<br />
Colors &gt; Invert gives us the right picture.<br />
Then File &gt; Export as..<br />
Save as joker2.png<br />
And here’s the trick, untick all the options:<br />
![alt text](gimp.png “”)</p>

<p>The MD5 hash of this file was the flag.<br />
Turns out I was the first to find it, happy about that.</p>

</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
