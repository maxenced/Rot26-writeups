<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      DGA &middot; Rot26
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="page">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Rot26
      </a>
    </div>
    <p class="lead"></p>
  </header>
  <nav id="sidebar-nav-links">
  
  

  

  


  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  

  

  

  

  
    
  

  

  

  
    
  

  

  
    
  

  

  
    
  

  


  

<h1>CTFs</h1>

  
    
  

  
    
      <a class="category-link "
          href="/category/BreizhCTF.html">BreizhCTF</a>
    
  

  
    
      <a class="category-link "
          href="/category/Hacklu.html">Hacklu</a>
    
  

  
    
      <a class="category-link "
          href="/category/LabyREnth.html">LabyREnth</a>
    
  

  
    
      <a class="category-link "
          href="/category/MetaSploitable3.html">MetaSploitable3</a>
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  

  

  

  

  
    
  

  

  

  
    
  

  

  
    
  

  

  
    
  

  



  <h1>Members</h1>
<a href="https://twitter.com/Memoi2001">Fooker</a>
<a href="https://twitter.com/kalimer0x00">Kalimer0x00</a>
<a href="https://twitter.com/govlog">Govlog</a>
<a href="https://twitter.com/maxencedun">Sp4rKy</a>


</nav>


  

  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  

  

  <!-- Optional additional links to insert for icons links -->
</nav>
  
</div>

    <main class="container">
      <div class="content">
  <h1 id="dga">DGA</h1>

<p>In this last prog challenge, connecting to the remote socket gave us something like :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>There's a new threat actor in town, and he claims to be a "Binary Ninja who Loves DGAs". We found some domains generated by one of his D
GA's, can you figure out the domain for when we plan to take him down?

Here's the data that we got:

(372720574, '1981/10/23 21:29:34', 'http://F1Mg61r0CSi80.dgeh')
(313126529, '1979/12/04 03:35:29', 'http://T1B50r1GFe70.dgeh')
(178331573, '1975/08/27 00:32:53', 'http://W0Sc40t0AZn70.dgeh')
(698912711, '1992/02/24 06:25:11', 'http://M2K50y0GGa90.dgeh')
(619720075, '1989/08/21 16:27:55', 'http://M2FE0t0GTi80.dgeh')
(1030239575, '2002/08/25 01:39:35', 'http://S3FeD0t0TSc00.dgeh')
(859343878, '1997/03/26 02:37:58', 'http://W3C70h0GS90.dgeh')
(1354104669, '2012/11/28 12:11:09', 'http://W5H60r1ACu10.dgeh')
(1464927891, '2016/06/03 04:24:51', 'http://F5SiA0e0CFe10.dgeh')
(482830956, '1985/04/20 07:42:36', 'http://S1Mn81l0GF80.dgeh')
(993389152, '2001/06/24 13:25:52', 'http://S3Ti60e1GF00.dgeh')
(225334872, '1977/02/21 01:01:12', 'http://M0FeD0y0TMn70.dgeh')
(739185329, '1993/06/04 09:15:29', 'http://F2Cr11e0TNe90.dgeh')
(838733472, '1996/07/30 13:31:12', 'http://T3LiF0y0GFe90.dgeh')
(1253292205, '2009/09/18 16:43:25', 'http://F4Sc60r0AHe00.dgeh')
(145846128, '1974/08/16 00:48:48', 'http://F0Cl60t0GCu70.dgeh')
(1404216603, '2014/07/01 12:10:03', 'http://T5N60y0CCa10.dgeh')
(758254375, '1994/01/11 02:12:55', 'http://T2Fe60y0GMg90.dgeh')
(389576490, '1982/05/06 23:41:30', 'http://T1Si70y0TNi80.dgeh')
(475797590, '1985/01/28 21:59:50', 'http://M1CrB0y0AH80.dgeh')
(1015521178, '2002/03/07 17:12:58', 'http://T3Mn01h0AZn00.dgeh')
(253462045, '1978/01/12 14:07:25', 'http://T0Zn30y0CCr70.dgeh')
(712482026, '1992/07/30 07:40:26', 'http://T2CaE1y0AK90.dgeh')
(906854029, '1998/09/26 23:53:49', 'http://S3Mg10r0AFe90.dgeh')
(1038195175, '2002/11/25 03:32:55', 'http://M3CoC0r0AN00.dgeh')
(1204721504, '2008/03/05 12:51:44', 'http://W4P90h0TCu00.dgeh')
(207682179, '1976/07/31 17:29:39', 'http://S0CrC0y1ANe70.dgeh')
(1415218931, '2014/11/05 20:22:11', 'http://W5OB0r0CCo10.dgeh')
(537042487, '1987/01/07 18:28:07', 'http://W2Nu00y0ACr80.dgeh')
(247928040, '1977/11/09 12:54:00', 'http://W0Cu81r0TK70.dgeh')
(225702078, '1977/02/25 07:01:18', 'http://F0FeE0y1THe70.dgeh')
(194136270, '1976/02/25 22:44:30', 'http://W0V20y0GLi70.dgeh')
(922592181, '1999/03/28 03:36:21', 'http://S3AlF0h0CSi90.dgeh')
(141792109, '1974/06/30 02:41:49', 'http://S0SE0e0TAl70.dgeh')
(422634404, '1983/05/24 14:26:44', 'http://T1Ar60y1CSi80.dgeh')
(698102055, '1992/02/14 21:14:15', 'http://F2K30y0TBe90.dgeh')
(1494986000, '2017/05/17 01:53:20', 'http://W5Ar30y0GCa10.dgeh')
(1450347733, '2015/12/17 10:22:13', 'http://T5MgE0r0GK10.dgeh')
(979351457, '2001/01/13 02:04:17', 'http://S3CaB1y0TZn00.dgeh')
(1059599780, '2003/07/30 21:16:20', 'http://W3Zn50y0TTi00.dgeh')
(1406131521, '2014/07/23 16:05:21', 'http://W5N91y0ASc10.dgeh')
(560817170, '1987/10/09 22:32:50', 'http://F2HeD0r0CS80.dgeh')
(699951958, '1992/03/07 07:05:58', 'http://S2K70h0GAl90.dgeh')
(198635517, '1976/04/18 00:31:57', 'http://S0VA0l1GGa70.dgeh')
(206322537, '1976/07/15 23:48:57', 'http://T0Cr90y0AAl70.dgeh')
(458953987, '1984/07/17 23:13:07', 'http://T1TiB0y0TCa80.dgeh')
(526776429, '1986/09/10 22:47:09', 'http://W1ZnC0r1AH80.dgeh')
(1182461562, '2007/06/21 21:32:42', 'http://T4MgF0e1GMn00.dgeh')
(386596130, '1982/04/02 11:48:50', 'http://F1Si10l1ACa80.dgeh')
(937075529, '1999/09/11 18:45:29', 'http://S3PB0r0CAl90.dgeh')

But the last one we got was empty, can you solve it?
(1529078400, '2018/06/15 16:00:00', '?')
</code></pre></div></div>

<p>It didn’t took too long to understand that DGA stands for <a href="https://en.wikipedia.org/wiki/Domain_generation_algorithm">Domain Generation
Algorithm</a>.
Basically, this is the name given to algorithm used to generate C&amp;C domain name
in a deterministic way.</p>

<p>So the goal is easy … to understand. We need to reverse the algorithm with provided samples to guess the last one.</p>

<p>After some time spent on the challenge, we see that :</p>

<ul>
  <li>not all the patterns are used every time</li>
  <li>the patterns order change every time</li>
  <li>a same pattern can be used more than one time</li>
</ul>

<p>Each of the “selector” I wrote does the same thing. It tries to check that it
is the next pattern, then returns the next value for the url to find.<br />
Each one takes 2 parameters :</p>

<ul>
  <li>The list of tuples with known url</li>
  <li>The current state of result to guess</li>
</ul>

<p>Let’s dig through the various patterns.</p>

<h2 id="first-letter-of-the-day">First letter of the day</h2>

<p>In the sample we see that first letter is one of S,F,T,W,M. Easy to understand
that it stands for S(aturday|unday), Friday, T(uesday|hursday), Wednesday and
Monday.</p>

<p>Simple code for this :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">s_first_letter_of_day</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
    <span class="s">""" Check if next char is the first letter of the day """</span>
    <span class="k">if</span> <span class="bp">False</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">A"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="n">lines</span> <span class="p">]:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">next_char</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">A"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_guess</span><span class="o">=</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">next_char</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">remove_char</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">new_guess</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="3-bits-to-integer">3 bits to integer</h2>

<p>Next one was simple too. You need to convert timestamp to binary, then just
uses 3 first bits and convert them to integer. Just, the binary number must be left-padded to 31 bits.</p>

<p>Ex:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#(372720574, '1981/10/23 21:29:34', 'http://F1Mg61r0CSi80.dgeh')</span>
<span class="o">&gt;&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">372720574</span><span class="p">,</span><span class="s">"031b"</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>
<span class="mi">1</span>
<span class="c">#(937075529, '1999/09/11 18:45:29', 'http://S3PB0r0CAl90.dgeh')</span>
<span class="o">&gt;&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">937075529</span><span class="p">,</span><span class="s">"031b"</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>
<span class="mi">3</span>
</code></pre></div></div>

<p>Code for this selector is :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">s_3bits_to_int</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
    <span class="s">""" Check if next char is a number which is the same as next 3 bits """</span>
    <span class="k">global</span> <span class="n">current_bit</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">:</span> <span class="c"># test it is a number</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bin_t</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="n">next_char</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="mi">3</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">new_guess</span><span class="o">=</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">next_char</span><span class="p">)</span>
    <span class="n">current_bit</span> <span class="o">+=</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">remove_char</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">new_guess</span><span class="p">)</span>
</code></pre></div></div>

<p><em>Note</em> : It is important to understand that the position of the bits will
depend of previously used selectors. In this example, this is the first
selector using timestamp’s binary version, so we use the 3 first bits.
But, if any other selector would have been used before, we’d take the 3 “next” bits.</p>

<h2 id="periodic-table">Periodic table</h2>

<p>This one was really funny. You can notice that the next char is an uppercase
letter, followed by one of uppercase, lowercase or number :/</p>

<p>Some sample should ring some bell in your mind, like <code class="highlighter-rouge">Mg</code>, <code class="highlighter-rouge">Si</code> or <code class="highlighter-rouge">Mn</code> …
Yes, you got it, these are part of the periodic table (crazy author …)</p>

<p>After I spent way too much time on it, I understood that it is based on either :</p>

<ul>
  <li>the next 4 bits</li>
  <li>the next 5 bits</li>
</ul>

<p>converted to integer. This gives us the atomic number of the element. Depending
of the element, it can be a one or 2 chars object.</p>

<p>The code for these 2 cases (4 and 5 bits):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">s_periodic_table_4</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s_periodic_table</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">s_periodic_table_5</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s_periodic_table</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">s_periodic_table</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="s">""" Check if next (two) char(s) exists in periodic table and the next 'n'
    bits correspond to their number in this table """</span>
    <span class="k">global</span> <span class="n">current_bit</span>
    <span class="n">table</span><span class="o">=</span><span class="p">{</span>
        <span class="s">"Nu"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c"># not a real one</span>
        <span class="s">"H"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>    <span class="s">"He"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>   <span class="s">"Li"</span><span class="p">:</span>  <span class="mi">3</span><span class="p">,</span> <span class="s">"Be"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>   <span class="s">"B"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>    <span class="s">"C"</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>    <span class="s">"N"</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>    <span class="s">"O"</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s">"F"</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>    <span class="s">"Ne"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>  <span class="s">"Na"</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s">"Mg"</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>  <span class="s">"Al"</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>  <span class="s">"Si"</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>  <span class="s">"P"</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>   <span class="s">"S"</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
        <span class="s">"Cl"</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>  <span class="s">"Ar"</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>  <span class="s">"K"</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>  <span class="s">"Ca"</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>  <span class="s">"Sc"</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span>  <span class="s">"Ti"</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>  <span class="s">"V"</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span>   <span class="s">"Cr"</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
        <span class="s">"Mn"</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>  <span class="s">"Fe"</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span>  <span class="s">"Co"</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span> <span class="s">"Ni"</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>  <span class="s">"Cu"</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span>  <span class="s">"Zn"</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>  <span class="s">"Ga"</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>  <span class="s">"Ge"</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>
        <span class="n">elmt</span><span class="o">=</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="ow">and</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">&lt;=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">elmt</span> <span class="o">+=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">elmt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c">#print("elmt : %s , int : %s" % (elmt,int(bin_t,2)))</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">table</span><span class="p">[</span><span class="n">elmt</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bin_t</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">elmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="n">elmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bin_t</span><span class="p">,</span><span class="mi">2</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="n">guess_bin_t</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="n">n</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">next_char</span><span class="o">=</span><span class="s">''</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">guess_bin_t</span><span class="p">:</span>
            <span class="n">next_char</span><span class="o">=</span><span class="n">k</span>
    <span class="n">new_guess</span><span class="o">=</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">next_char</span><span class="p">)</span>

    <span class="c"># I can't use remove_char() here as the number of char may change between lines</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="ow">and</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">bin_t</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">:]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
    <span class="n">current_bit</span> <span class="o">+=</span> <span class="n">n</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">new_guess</span><span class="p">)</span>
</code></pre></div></div>

<p>You’ll notice that:</p>

<ul>
  <li>There is an extra “Nu” (which I guess stands for “Null” with value 0)</li>
  <li>We use at most 5 bits, so up to a value of 32, so no need to get the whole table</li>
</ul>

<h2 id="hex-char">Hex char</h2>

<p>Next, a simple one, just take next 4 bits and write corresponding hex :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">s_hex_value</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
    <span class="s">""" Check if next  char is hex value corresponding to next 4 bits"""</span>
    <span class="k">global</span> <span class="n">current_bit</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">hexdigits</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bin_t</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s">"X"</span><span class="p">)</span> <span class="o">!=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="n">guess_bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">next_char</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">guess_bin_t</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s">"X"</span><span class="p">)</span>
    <span class="n">new_guess</span><span class="o">=</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">next_char</span><span class="p">)</span>
    <span class="n">current_bit</span> <span class="o">+=</span> <span class="mi">4</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">remove_char</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">new_guess</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="23-bits-and">2/3 bits AND</h2>

<p>Next, you’ll notice that you have only ‘0’  or ‘1’. These are in fact a logical
AND between the next 2 or 3 bits (depends of the sample):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">s_2bits_and</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
    <span class="s">""" Check if next char is the AND of the 2 next bytes """</span>
    <span class="k">global</span> <span class="n">current_bit</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"0"</span><span class="p">,</span><span class="s">"1"</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bin_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">int</span><span class="p">(</span><span class="n">bin_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="n">guess_bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">next_char</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">guess_bin_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">int</span><span class="p">(</span><span class="n">guess_bin_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">new_guess</span><span class="o">=</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">next_char</span><span class="p">)</span>
    <span class="n">current_bit</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">remove_char</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">new_guess</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">s_3bits_and</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
    <span class="s">""" Check if next char is the AND of the 3 next bytes """</span>
    <span class="k">global</span> <span class="n">current_bit</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"0"</span><span class="p">,</span><span class="s">"1"</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bin_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">int</span><span class="p">(</span><span class="n">bin_t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">int</span><span class="p">(</span><span class="n">bin_t</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="n">guess_bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">next_char</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">guess_bin_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">int</span><span class="p">(</span><span class="n">guess_bin_t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">int</span><span class="p">(</span><span class="n">guess_bin_t</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">new_guess</span><span class="o">=</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">next_char</span><span class="p">)</span>
    <span class="n">current_bit</span> <span class="o">+=</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">remove_char</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">new_guess</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="last-letter-of-month">Last letter of month</h2>

<p>After the first-letter-of-day, we now have a similar one =&gt; last letter of month :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">s_last_letter_of_month</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
    <span class="s">""" Check if next char is the last letter of the month """</span>
    <span class="k">if</span> <span class="bp">False</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">B"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="n">lines</span> <span class="p">]:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">next_char</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">B"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">new_guess</span><span class="o">=</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">next_char</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">remove_char</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">new_guess</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="acgt">A,C,G,T</h2>

<p>Next one is again a 0/1 from a AND between bits, already covered.
Then, you have an uppercase letter, one of A,C,G,T.</p>

<p>Not to difficult, it just match the next 2 bits of timestamp. Be careful,
however, that one value does not always map to the same letter.  So I had to
dynamically build the mapping, then check :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">s_acgt</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
    <span class="s">""" Check if next char is one of ACGT and correspond to the next 2 bits of timestamp """</span>
    <span class="k">global</span> <span class="n">current_bit</span>
    <span class="n">acgt_map</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'A'</span><span class="p">,</span><span class="s">'C'</span><span class="p">,</span><span class="s">'G'</span><span class="p">,</span><span class="s">'T'</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bin_t</span> <span class="ow">in</span> <span class="n">acgt_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">acgt_map</span><span class="p">[</span><span class="n">bin_t</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">acgt_map</span><span class="p">[</span><span class="n">bin_t</span><span class="p">]</span> <span class="o">!=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">acgt_map</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">guess_bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">next_char</span><span class="o">=</span><span class="n">acgt_map</span><span class="p">[</span><span class="n">guess_bin_t</span><span class="p">]</span>
    <span class="n">new_guess</span><span class="o">=</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">next_char</span><span class="p">)</span>
    <span class="n">current_bit</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">remove_char</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">new_guess</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="third-number-of-the-year">Third number of the year</h2>

<p>Then we again have the periodic table, and to finish we have 2 numbers. These are the decenie of the date (ex : 1982 =&gt; 80).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">s_year_third_number</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
    <span class="s">""" Check if next 2 chars are the 3rd number of year and a "0" """</span>
    <span class="k">global</span> <span class="n">current_bit</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"0"</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">y"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="n">next_char</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">y"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">"0"</span>
    <span class="n">new_guess</span><span class="o">=</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">next_char</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">remove_char</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">new_guess</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="step-2">Step 2</h1>
<p>So with all these selectors, I was able to find the correct domain :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Your solution: http://F5Ti40e1CNe10.dgeh
[...]
Hmm we found another DGA, can you figure out the next one?

Here's the data that we got:
[...]
</code></pre></div></div>

<p>Yes, again … more samples ! At the end, there were 5 rounds. First had 50 samples, 2nd 40, then 30, 20 and 10.</p>

<p>The goal is always the same, and I just found an extra selectors to write :</p>

<h2 id="true--false-to-letter">True / False to letter</h2>

<p>Sometimes you had only two (uppercase) letters. Corresponding to the next bit (0 =&gt; first letter, 1 =&gt; second letter).
So I had to first build the mapping, then check everything match:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">s_true_false</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">guess</span><span class="p">):</span>
    <span class="s">""" Check if next letter corresponds to next bit (1/0) (one for 1, one for 0)"""</span>
    <span class="k">global</span> <span class="n">current_bit</span>
    <span class="n">tf_map</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bin_t</span> <span class="ow">in</span> <span class="n">tf_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">tf_map</span><span class="p">[</span><span class="n">bin_t</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tf_map</span><span class="p">[</span><span class="n">bin_t</span><span class="p">]</span> <span class="o">!=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="n">guess_bin_t</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">"031b"</span><span class="p">)[</span><span class="n">current_bit</span><span class="p">:</span><span class="n">current_bit</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">next_char</span><span class="o">=</span><span class="n">tf_map</span><span class="p">[</span><span class="n">guess_bin_t</span><span class="p">]</span>
    <span class="n">new_guess</span><span class="o">=</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">guess</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">next_char</span><span class="p">)</span>
    <span class="n">current_bit</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">remove_char</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">new_guess</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="get-the-flag">Get the flag</h1>

<p>At the end, I was too lazy to submit the result automatically as there was no time constraint, so I just finished my script with some local variable to set at the beginning of the file :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">selectors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">s_acgt</span><span class="p">,</span>
    <span class="n">s_last_letter_of_month</span><span class="p">,</span>
    <span class="n">s_first_letter_of_day</span><span class="p">,</span>
    <span class="n">s_3bits_to_int</span><span class="p">,</span>
    <span class="n">s_2bits_and</span><span class="p">,</span>
    <span class="n">s_3bits_and</span><span class="p">,</span>
    <span class="n">s_periodic_table_5</span><span class="p">,</span>
    <span class="n">s_periodic_table_4</span><span class="p">,</span>
    <span class="n">s_true_false</span><span class="p">,</span>
    <span class="n">s_hex_value</span><span class="p">,</span>
    <span class="n">s_year_third_number</span>
<span class="p">]</span>

<span class="n">prepared_b</span> <span class="o">=</span> <span class="n">remove_http</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="n">selector_order</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="n">prepared_b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">(</span><span class="n">prepared_b</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
            <span class="n">selector_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">prepared_b</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">guess</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">print</span><span class="p">(</span><span class="s">" `-&gt; Selector </span><span class="si">%</span><span class="s">s worked. Current answer :</span><span class="si">%</span><span class="s">s "</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">guess</span><span class="p">))</span>
            <span class="k">break</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Found selector order : </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="s">' '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">selector_order</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Expected solution : </span><span class="si">%</span><span class="s">s.dgeh"</span> <span class="o">%</span> <span class="n">guess</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></div>

<p>And finally :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[40 samples]
And here's the one we need:
(1529078400, '2018/06/15 16:00:00', '?')

Your solution: http://10NaTCOGFNiNee.dgeh

Hmm we found another DGA, can you figure out the next one?
Here's the data that we got:

[30 samples]

And here's the one we need:
(1529078400, '2018/06/15 16:00:00', '?')


Your solution: http://FNaCG03101HeGe.dgeh
Hmm we found another DGA, can you figure out the next one?

Here's the data that we got:

[20 samples]

And here's the one we need:
(1529078400, '2018/06/15 16:00:00', '?')


Your solution: http://e5BBe0F1TNe10.dgeh
Hmm we found another DGA, can you figure out the next one?

Here's the data that we got:

[10 samples]

And here's the one we need:
(1529078400, '2018/06/15 16:00:00', '?')


Your solution: http://FNaMgG3eACl010.dgeh
You are the master of DGeh's! PAN{wh4t_w4s_th4t_dg3h_ab00t}
</code></pre></div></div>

</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
